### 📌 14. 쿠키와 세션, 웹스토리지

**Http 요청은 기본적으로 상태가 존재하지 않음.** (항상 단발성) 이에 따라 서버가 어떤 브라우저에서 요청이 온 것인지 알 수 없지만 `헤더에 쿠키` 를 담게될 경우 `서버가 쿠키` 를 읽어 어디서 온 것인지 알 수 있게된다.

### 쿠키

- 쿠키란 프론트엔드에서 관리하고 저장하는 데이터를 말한다. (브라우저를 닫아도 데이터가 유지됨)
- 서버에서 set-cookie를 응답 헤더로 내려주면 클라이언트가 이를 받고 알아서 저장함. (만약 이게 싫다면 자제척으로 조작 가능)
- 각 상태에서 수명 정해줄 수 있음


#### set-cookie
서버에서 내려주는 set-cookie는 `키=값` 형태로 내려온다. 클라이언트가 이 값을 파싱하여 알아서 쿠키에 데이터를 추가함. 각 데이터에는 다음과 같은 여러 옵션들이 존재할 수 있다.

- `Expires` : 쿠키 만료 날짜 지정
- `Secure` : HTTPS에서만 쿠키 전송
- `HttpOnly` : JS에서 쿠키 접근 못하게 막음 (XSS 예방)
- `Max-Age` : 쿠키 수명 정함 (expire와 유사하지만 해당 설정이 존재할 경우 expire를 무시)
- `Domain` : 도메인이 일치하는 요청만 쿠키 전송
- `Path` : 패스와 일치하는 요청만 쿠키 전송

> **쿠키의 취약점**
**XSS (Cross-Site Script) 공격**
JS를 통해 해커가 다른 사용자의 쿠키값을 탈취할 수 있다. 위에서 말한 `httponly옵션` 을 사용할 수 있지만 최근에는 SPA 개발이 주를 이루기 때문에 사용하기 힘들다.
또한 쿠키를 암호화하지 않고 보내게될 경우 쿠키값을 중간에 탈취 당할 가능성이 있다. (Https로 해결 가능!)

클라이언트가 쿠키를 아무리 보내도 서버는 이를 알지 못하는데 그렇다면 어떻게 해야할까?

> 답은 **세션**을 이용하는 것이다

### Session

**쿠키에 http session id를 식별자로 담아 클라이언트와 서버간에 통신이 가능** 하다. -> 서버는 식별자로 사용자를 구분하고 적절한 데이터를 응답해줌

> #### 세션의 취약점
1. 만약 사용자가 많아진다면? -> 저장 공간 부족으로 동작 안함
2. 서버가 2대라면 세션은 어떻게 관리? -> 인증 정보가 흩어져있기 때문에 제대로 응답 못할 가능성 높아짐

이러한 이유로 최근에는 인증 용도로 세션을 사용하지 않는다. 그래서 이를 해결하기 위해 **서버와 클라이언트간의 인증은 JWT같은 별도의 토큰을 이용하고 쿠키는 클라이언트 자체적인 데이터 관리 용도로 많이 사용**한다.


### 웹 스토리지
- 쿠키에서 하기 힘든 것들을 해결하기 위해 등장
- HTML5부터 등장
- 로컬 스토리지, 세션 스토리지가 존재

> #### 로컬 스토리지
- 데이터가 반영구적으로 저장됨 (브라우저 종료해도 남는다.)
- 쿠키와 마찬가지로 저장했던 도메인과 이용하는 도메인이 다를 경우 접근 불가
- 쿠키와 마찬가지로 Key-value 형태로 저장
#### 세션 스토리지
- 새 창 생성시마다 개별적으로 데이터 저장 (브라우저 닫는 순간 사라짐.)
- 로컬 스토리지와 다르게 같은 도메인이라도 세션이 다르다면 데이터 접근 불가
- 쿠키와 마찬가지로 Key-value 형태로 저장


#### 쿠키, 로컬 스토리지, 세션 스토리지 사용 예제


```js
// 쿠키: document 객체를 통해 관리 (string으로 관리되어 값 추가 등 매우 불편 -> 라이브러리 사용 권장)
document.cookie = 'key=value; key2=value2';

// 로컬 스토리지, 세션 스토리지는 쿠키에 비해 사용하기 편함. + 같은 인터페이스를 가지기 때문에 외우기도 좋음
localStorage.setItem('name', '팜윤태');
console.log(localStorage.getItem('name')); // 팜윤태

localStorage.removeItem('name');
localStorage.clear(); // 데이터 전부 제거


sessionStorage.setItem('name', '팜윤태');
console.log(sessionStorage.getItem('name')); // 팜윤태

sessionStorage.removeItem('name');
sessionStorage.clear(); // 데이터 전부 제거
```